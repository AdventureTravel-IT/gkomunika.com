<style>
  .flex-center {
    display: flex;
    align-items: center;
  }

  .inline-flex-center {
    display: inline-flex;
    align-items: center;
  }

  .icon-24 {
    width: 24px;
    height: 24px;
  }

  .header-menu,
  .sidebar-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  a {
    text-decoration: none;
  }

  .header__wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
  }

  .header__container {
    width: 100%;
  }

  .header-conten-menu {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .header-right {
    display: flex;
  }

  .header-menu {
    display: flex;
    gap: 15px;
    align-items: center;
  }

  .menu-list {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--color-primary);
  }

  .menu-toggle {
    border: none;
    background: transparent;
    padding: 0;
    cursor: pointer;
  }

  .currency-language {
    display: flex;
    align-items: center;
  }

  .currency-language-group {
    display: flex;
    align-items: center;
  }

  .localization-inner {
    display: flex;
    align-items: center;
  }

  .sidebar-list {
    display: grid;
    gap: 10px;
  }

  .sidebar-link {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--color-primary);
    padding-left: 10px;
  }

  .sidebar-link:hover {
    background: rgba(0, 0, 0, 0.04);
  }

  #navbar {
    display: flex;
    align-items: center;
  }

  #sidebar {
    display: none;
  }

  .sidebar-mobile-block {
    display: none;
  }

  .header-mobile-right {
    display: none;
    align-items: center;
    gap: 12px;
    margin-left: auto;
  }

  .header-mobile-icon {
    display: inline-flex;
    align-items: center;
  }

  .header-mobile-icon img {
    width: 24px;
    height: 24px;
  }

  .animated-icon {
    position: relative;
    width: 20px;
    height: 20px;
    cursor: pointer;
  }

  .animated-icon span {
    position: absolute;
    width: 100%;
    height: 3px;
    background: var(--color-primary);
    border-radius: 2px;
    transition: all 0.2s ease-in-out;
  }

  .animated-icon span:nth-child(1) {
    top: 0;
  }

  .animated-icon span:nth-child(2) {
    top: 8px;
  }

  .animated-icon span:nth-child(3) {
    top: 16px;
  }

  .animated-icon.open span:nth-child(1) {
    top: 8px;
    transform: rotate(45deg);
  }

  .animated-icon.open span:nth-child(2) {
    opacity: 0;
  }

  .animated-icon.open span:nth-child(3) {
    top: 8px;
    transform: rotate(-45deg);
  }

  .header-cart,
  .header-cart-link {
    position: relative;
  }

  .header-cart-icon-wrapper {
    position: relative;
    display: inline-flex;
  }

  .header-cart__badge {
    position: absolute;
    top: -4px;
    right: -8px;
    min-width: 16px;
    height: 16px;
    padding: 0 4px;
    border-radius: 999px;
    background: var(--color-primary);
    color: #fff;
    font-size: 10px;
    line-height: 16px;
    text-align: center;
    font-weight: 600;
    box-shadow: 0 0 0 2px #fff;
  }

  body.sidebar-open .product-form,
  body.sidebar-open .product__info-wrapper,
  body.sidebar-open .product__sticky,
  body.sidebar-open .product-form__buttons,
  body.sidebar-open .product-buy-buttons,
  body.sidebar-open .main-product-header-right,
  body.sidebar-open .main-product-container .BuyButtonsWrap,
  body.sidebar-open [data-sticky],
  body.sidebar-open [data-mobile-sticky] {
    display: none !important;
  }

  @media (max-width: 768px) {
    html,
    body {
      margin: 0 !important;
      padding: 0 !important;
      -webkit-text-size-adjust: 100%;
    }

    .shopify-section-header,
    .shopify-section[id*='shopify-section-header'] {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }

    .header__wrapper {
      padding: 0 24px;
    }

    .header-menu {
      display: none;
    }

    .currency-language {
      display: none;
    }

    .header-mobile-right {
      display: flex;
    }

    #sidebar {
      display: block;
      width: 100%;
      position: static;
    }

    .sidebar-panel {
      position: absolute;
      left: 0;
      width: 100%;
      max-height: 0;
      opacity: 0;
      overflow-y: auto;
      background-color: var(--color-neutral);
      z-index: 999999;
      transition: max-height 0.35s ease, opacity 0.25s ease;
    }

    .sidebar-panel.active {
      max-height: calc(100vh - 60px);
      opacity: 1;
      transform: translateY(0);
      min-height: 1px;
    }

    .sidebar-list {
      display: block;
    }

    .sidebar-list li {
      border-bottom: 1px solid #d9d9d9;
      padding: 10px 0;
      margin: 0;
    }

    .sidebar-link {
      padding: 0 24px;
    }

    .sidebar-mobile-block {
      padding: 12px 24px 16px;
      display: block;
      border-top: 1px solid #eaeaea;
    }

    .sidebar-mobile-block .currency-language {
      display: flex;
      gap: 12px;
    }

    .sidebar-mobile-block .localization-form {
      margin-left: 4px;
    }

    .menu-toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      position: relative;
      z-index: 50;
      -webkit-tap-highlight-color: transparent;
    }
  }
</style>

{% unless template == 'customers/login' or template == 'customers/register' %}
  <div class="header__container">
    <div class="header__wrapper">
      <div class="header-conten-menu">
        <button class="menu-toggle" type="button" aria-label="Open Menu" aria-expanded="false">
          <div class="animated-icon" id="menu-icon">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>

        {% if section.settings.logo != blank %}
          <a href="{{ routes.root_url }}" class="inline-flex-center">
            <img
              class="header-content-logo"
              src="{{ section.settings.logo | image_url: width: 120 }}"
              srcset="
                {{ section.settings.logo | image_url: width: 120 }} 120w,
                {{ section.settings.logo | image_url: width: 240 }} 240w
              "
              sizes="120px"
              width="120"
              height="40"
              alt="Global Komunika"
              loading="eager"
            >
          </a>
        {% endif %}
      </div>

      <div class="header-mobile-right" aria-label="Quick actions">
        <a href="{{ routes.cart_url }}" class="header-mobile-icon header-cart" aria-label="Cart">
          <span class="header-cart-icon-wrapper">
            <img src="{{ 'header-cart.svg' | asset_url }}" alt="Cart" class="icon-24">
            {% if cart.items.size > 0 %}
              <span class="header-cart__badge">{{ cart.items.size }}</span>
            {% endif %}
          </span>
        </a>

        {% assign profile_url = customer | default: false %}
        {% if customer %}
          {% assign profile_url = routes.account_url %}
        {% else %}
          {% assign profile_url = routes.account_login_url %}
        {% endif %}

        <a href="{{ profile_url }}" class="header-mobile-icon" aria-label="Profile">
          <img src="{{ 'header-profile.svg' | asset_url }}" alt="Profile" class="icon-24">
        </a>
      </div>

      <div class="header-right">
        <div class="currency-language">
          <div class="currency-language-group">
            <div class="inline-flex-center">
              {{- 'header-currency.svg' | inline_asset_content -}}
            </div>
            <div id="bucks-floating-desktop"></div>
          </div>

          <localization-form>
            {%- form 'localization', id: 'FooterLanguageForm', class: 'localization-form' -%}
              <div class="localization-inner">
                {%- render 'language-localization', localPosition: 'FooterLanguage' -%}
              </div>
            {%- endform -%}
          </localization-form>
        </div>

        <div
          id="navbar"
          role="navigation"
          aria-label="Main navigation"
          data-root-url="{{ routes.root_url }}"
          data-icons='
                    {
                      "home": "{{ ' header-home.svg' | asset_url }}", "esim" : "{{ 'header-esim.svg' | asset_url }}"
            , "simcard" : "{{ 'header-simcard.svg' | asset_url }}" , "insurance"
            : "{{ 'header-insurance.svg' | asset_url }}" , "usage" : "{{ 'header-usage.svg' | asset_url }}" , "topup"
            : "{{ 'icon-plus.svg' | asset_url }}" , "about" : "{{ 'header-about.svg' | asset_url }}" , "faq"
            : "{{ 'header-faq.svg' | asset_url }}" , "news" : "{{ 'header-news.svg' | asset_url }}" , "cart"
            : "{{ 'header-cart.svg' | asset_url }}" , "profile" : "{{ 'header-profile.svg' | asset_url }}" }
          '
        ></div>
      </div>
    </div>

    <div id="sidebar">
      <div class="sidebar-panel" aria-hidden="true">
        <div id="sidebar-list"></div>

        <div class="sidebar-mobile-block">
          <div class="currency-language">
            <div class="currency-language-group">
              <div class="inline-flex-center">
                {{- ' header-currency.svg' | inline_asset_content -}}
              </div>
              <div id="bucks-mobile"></div>
            </div>

            <localization-form>
              {%- form 'localization', id: 'FooterLanguageFormSidebar', class: 'localization-form' -%}
                <div class="localization-inner">
                  {%- render 'language-localization', localPosition: 'FooterLanguage' -%}
                </div>
              {%- endform -%}
            </localization-form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endunless %}

<script>
  window.cartItemCount = {{ cart.items | size | default: 0 | plus: 0 }};

  (function () {
    const nav = document.getElementById('navbar');
    if (!nav) return;

    const iconsData = nav.getAttribute('data-icons');
    if (!iconsData) return;

    const icons = JSON.parse(iconsData);

    const rawRootUrl = nav.getAttribute('data-root-url') || '';
    const cleanRoot = rawRootUrl.replace(/\/$/, '');

    function makeUrl(path) {
      if (!path || path === '/') {
        return cleanRoot || '/';
      }
      const cleanPath = path.startsWith('/') ? path : '/' + path;
      return cleanRoot + cleanPath;
    }

    const menu = [
      { label: 'Home', icon: icons.home, link: makeUrl('/') },
      { label: 'eSIM', icon: icons.esim, link: makeUrl('pages/product-category?sim_type=esim') },
      { label: 'SIM Card', icon: icons.simcard, link: makeUrl('pages/product-category?sim_type=sim-card') },
      { label: 'Insurance', icon: icons.insurance, link: makeUrl('pages/product-category?sim_type=insurance') },
      { label: 'Data Usage', icon: icons.usage, link: makeUrl('pages/check-data-usage') },
      { label: 'Top Up', icon: icons.topup, link: makeUrl('pages/check-data-usage-topup') },
      { label: 'About Us', icon: icons.about, link: makeUrl('pages/about-us') },
      { label: 'FAQ', icon: icons.faq, link: makeUrl('pages/faq') },
      { label: 'News', icon: icons.news, link: makeUrl('pages/news') },
    ];

    function renderMenuList(items) {
      const itemsHtml = items
        .map(
          (item) => `
            <li>
              <a href="${item.link}" class="sidebar-link">
                <img src="${item.icon}" alt="${item.label} icon" class="icon-24" />
                <span style="font-weight:bold;">${item.label}</span>
              </a>
            </li>`
        )
        .join('');
      return `<ul class="sidebar-list">${itemsHtml}</ul>`;
    }

    function renderHeaderMenu({ container, items }) {
      const fullItems = items.concat([
        { label: 'Cart', icon: icons.cart, link: "{{ routes.cart_url }}" },
        { label: 'Profile', icon: icons.profile, link: "{{ routes.account_url }}" },
      ]);

      const count = window.cartItemCount || 0;

      const itemsHtml = fullItems
        .map((item) => {
          const isCart = item.label === 'Cart';
          const badge =
            isCart && count > 0
              ? `<span class="header-cart__badge">${count}</span>`
              : '';

          return `
            <li>
              <a href="${item.link}"
                 class="menu-list ${isCart ? 'header-cart-link' : ''}">
                <span class="header-cart-icon-wrapper">
                  <img src="${item.icon}" alt="${item.label} icon" class="icon-24" />
                  ${badge}
                </span>
                <span style="font-weight:bold;">${item.label}</span>
              </a>
            </li>`;
        })
        .join('');
      container.innerHTML = `<ul class="header-menu">${itemsHtml}</ul>`;
    }

    renderHeaderMenu({ container: nav, items: menu });

    const sidebarListMount = document.getElementById('sidebar-list');
    if (sidebarListMount) {
      sidebarListMount.innerHTML = renderMenuList(menu);
    }

    const sidebarPanel = document.querySelector('.sidebar-panel');
    const menuToggleBtn = document.querySelector('.menu-toggle');
    const menuIcon = document.getElementById('menu-icon');
    const root = document.documentElement;

    function setScrollLock(locked) {
      const value = locked ? 'hidden' : '';
      root.style.overflow = value;
      document.body.style.overflow = value;
    }

    function setMenuState(isOpen) {
      if (!sidebarPanel) return;

      sidebarPanel.classList.toggle('active', isOpen);
      sidebarPanel.setAttribute('aria-hidden', isOpen ? 'false' : 'true');

      if (menuIcon) {
        menuIcon.classList.toggle('open', isOpen);
      }
      if (menuToggleBtn) {
        menuToggleBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        menuToggleBtn.setAttribute('aria-label', isOpen ? 'Close Menu' : 'Open Menu');
      }
      setScrollLock(isOpen);

      document.body.classList.toggle('sidebar-open', isOpen);
    }

    function toggleMenu() {
      if (!sidebarPanel) return;
      const isOpen = sidebarPanel.classList.contains('active');
      setMenuState(!isOpen);
    }

    function closeMenu() {
      if (!sidebarPanel || !sidebarPanel.classList.contains('active')) return;
      setMenuState(false);
    }

    if (menuToggleBtn) {
      menuToggleBtn.addEventListener('click', toggleMenu);
    }

    document.addEventListener('click', function (e) {
      if (!sidebarPanel || !sidebarPanel.classList.contains('active')) return;

      const clickInsidePanel = sidebarPanel.contains(e.target);
      const clickOnToggle = menuToggleBtn && menuToggleBtn.contains(e.target);

      if (!clickInsidePanel && !clickOnToggle) {
        closeMenu();
      }
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeMenu();
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Header Settings",
  "settings": [
    {
      "type": "link_list",
      "id": "selected_menu",
      "label": "Menu"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    }
  ]
}
{% endschema %}
