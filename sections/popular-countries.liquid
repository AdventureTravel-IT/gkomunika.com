{{ 'popular-countries.css' | asset_url | stylesheet_tag }}
<script src="{{ 'popular-countries__tabs.js' | asset_url }}" defer></script>

<div class="container-popular-countries">
  <div class="popular-countries">
    {% if request.page_type == 'collection' and collection.handle == 'all' %}
      <h2>{{ 'popular_countries.all_destination_title' | t }}</h2>
    {% else %}
      <h2>{{ 'popular_countries.title' | t }}</h2>
    {% endif %}

    <div class="tabs">
      <button class="tab-button active" data-tab="land">
        <span>{{ 'popular_countries.tab_land' | t }}</span>
      </button>
      <button class="tab-button" data-tab="region">
        <span>{{ 'popular_countries.tab_region' | t }}</span>
      </button>
    </div>

    <div
      class="tab-content"
      id="land"
      style="display: none; visibility: hidden;"
      data-columns="{{ section.settings.land_columns }}"
    >
      {% case section.settings.display_mode %}
        {% when 'option_1' %}
          {% assign collection = collections.all_country %}
          {% render 'land-country', collection: collection %}
        {% when 'option_2' %}
          {% assign collection = collections['all-country'] %}
          {% if collection != blank %}
            {% assign countries = collection.metafields.coverage.country_list.value %}
            {% render 'all-country', countries: countries %}
          {% endif %}
      {% endcase %}
    </div>

    <div
      class="tab-content"
      id="region"
      style="display: none; visibility: hidden;"
      data-columns="{{ section.settings.region_columns }}"
    >
      {% assign collection = collections[section.settings.region_collection] %}
      {% if collection and collection.products.size > 0 %}
        {% assign displayed_regions = '' %}
        {% assign item_index = 0 %}

        {% for product in collection.products %}
          {% assign region_value = product.metafields.coverage.region.value %}
          {% assign country_name = region_value | first %}

          {% if region_value and country_name != blank and country_name != null %}
            {% unless displayed_regions contains country_name %}
              {% assign displayed_regions = displayed_regions | append: ',' | append: country_name %}
              {% assign item_index = item_index | plus: 1 %}

              {% if item_index <= 8 %}
                {% assign img_loading = 'eager' %}
              {% else %}
                {% assign img_loading = 'lazy' %}
              {% endif %}

              <a href="{{ routes.search_url }}?q={{ country_name | url_encode }}">
                <div class="country">
                  <div class="text-content">
                    <img
                      src="{{ country_name | append: '.svg' | replace: ' ','_' | file_url }}"
                      alt="{{ country_name }}"
                      width="50"
                      height="50"
                      loading="{{ img_loading }}"
                      decoding="async"
                    >
                    <div class="collection-pick">
                      <p>{{ country_name | replace: '_', ' ' }}</p>
                      <span>
                        {{ 'popular_countries.start_from' | t }}
                        {{ product.price_min | money }}
                      </span>
                    </div>
                  </div>

                  <div class="country-icon">
                    {{- 'icon-arrow-back.svg' | inline_asset_content -}}
                  </div>
                </div>
              </a>
            {% endunless %}
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>

    <div class="show-all-wrapper">
      {% if section.settings.show_button %}
        <div class="show-all">
          <a
            href="{{ routes.collections_url }}/all?tab={{ active_tab }}"
            class="show-all-destination"
            data-active-tab="{{ active_tab }}"
          >
            <span>{{ 'popular_countries.show_all' | t }}</span>
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script type="application/ld+json">
  {{ page | structured_data }}
</script>

{% schema %}
{
  "name": "Popular Countries",
  "settings": [
    {
      "type": "select",
      "id": "display_mode",
      "label": "Display Mode",
      "options": [
        {
          "value": "option_1",
          "label": "Homepage"
        },
        {
          "value": "option_2",
          "label": "All Destination"
        }
      ],
      "default": "option_1"
    },
    {
      "type": "collection",
      "id": "land_collection",
      "label": "Display Land Top"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Display Land All Destination"
    },
    {
      "type": "collection",
      "id": "region_collection",
      "label": "Pilih Koleksi untuk Region"
    },
    {
      "type": "collection",
      "id": "global_collection",
      "label": "Pilih Koleksi untuk Global"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Popular Countries"
    },
    {
      "type": "text",
      "id": "tab_land",
      "label": "Tab 1 (Land)",
      "default": "Land"
    },
    {
      "type": "text",
      "id": "tab_region",
      "label": "Tab 2 (Region)",
      "default": "Region"
    },
    {
      "type": "text",
      "id": "tab_global",
      "label": "Tab 3 (Global)",
      "default": "Global"
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show 'Show All' Button",
      "default": true
    },
    {
      "type": "text",
      "id": "show_all_text",
      "label": "Show All Button Text",
      "default": "Show all destinations"
    }
  ],
  "presets": [
    {
      "name": "Popular Countries",
      "category": "Custom Sections"
    }
  ]
}
{% endschema %}
