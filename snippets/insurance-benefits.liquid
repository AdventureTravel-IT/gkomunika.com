<style>
  .insurance-table__scroll {
    overflow-x: auto;
    margin-bottom: 20px;
    height: 400px;
    overflow-y: auto;
    display: none;
    border-radius: 0 0 15px 15px;
  }
  .insurance-table__main {
    display: block;
    background-color: var(--color-background-third);
  }
  .insurance-table__scroll table {
    border-collapse: collapse;
    min-width: 900px;
    width: 100%;
    table-layout: fixed;
    background: var(--color-neutral);
  }
  .insurance-table__scroll th,
  .insurance-table__scroll td {
    padding: 10px;
    border: 1px solid var(--color-border);
    text-align: left;
    color: var(--color-primary);
    background: var(--color-neutral);
  }

  /* Kolom pertama sticky */
  .insurance-table__scroll th:first-child,
  .insurance-table__scroll td:first-child {
    position: sticky;
    left: 0;
    background: var(--color-neutral);
    color: var(--color-primary);
    z-index: 1;
    width: 40%;
    min-width: 150px;
    max-width: 250px;
    border-right: 1px solid var(--color-border);
  }

  /* Kolom lain */
  .insurance-table__scroll th:not(:first-child),
  .insurance-table__scroll td:not(:first-child) {
    width: 40%;
    min-width: 180px;
  }

  /* Header tetap sticky di atas */
  .insurance-table__scroll th {
    position: sticky;
    top: 0;
    background: var(--color-neutral);
    z-index: 2;
    border-bottom: 1px solid var(--color-border);
  }

  /* Perkuat sudut kiri atas (th pertama) */
  .insurance-table__scroll th:first-child {
    z-index: 3;
    border: 1px solid var(--color-border);
  }
  .insurance-table__title.desktop {
    display: block;
  }
  .insurance-table__title.mobile {
    display: none;
  }

  @media (max-width: 768px) {
    .insurance-table__container {
      display: none;
    }
    .insurance-table__scroll {
      display: block;
    }
    .insurance-table__main {
      display: none;
    }
    .insurance-table__title.desktop {
      display: none;
    }
    .insurance-table__title.mobile {
      display: block;
    }
  }

  @media (max-width: 426px) {
    .insurance-table__scroll th:first-child,
    .insurance-table__scroll td:first-child {
      width: 20%;
    }
    .insurance-table__scroll table.single-column-mode th:first-child,
    .insurance-table__scroll table.single-column-mode td:first-child {
      width: 10%;
    }
  }
</style>

<style>
  .insurance__heading {
    font-size: 26px;
    font-weight: 600;
    color: var(--color-primary);
    margin: 0;
  }

  .insurance-table__container {
    border-radius: 15px;
    height: 550px;
    overflow-y: hidden;
    position: relative;
    background-color: var(--color-background-third);
    color: var(--color-primary);
  }

  .insurance-table__expand-button {
    width: 100%;
    height: 180px;
    background: linear-gradient(to bottom, rgba(243, 251, 254, 0) 0%, rgba(184, 236, 255, 1) 78%);
    color: var(--color-primary);
    font-size: var(--font-large);
    font-weight: bold;
    cursor: pointer;
    border: none;
    position: absolute;
    bottom: 0;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 24px;
  }

  .insurance-table__title {
    background-color: var(--color-neutral);
    height: 60px;
    margin-bottom: 1px;
    text-align: center;
    align-items: center;
    display: flex;
    justify-content: center;
    font-size: 24px;
    font-weight: 600;
    color: var(--color-primary);
    border-radius: 15px 15px 0 0;
  }

  .insurance-table__main table th,
  .insurance-table__main table td {
    border: none !important;
    background-color: var(--color-neutral);
    text-align: left;
    font-size: var(--font-large);
  }

  .insurance-table__container--expanded {
    height: 100%;
    overflow-y: auto;
  }

  .insurance-table__main th,
  .insurance-table__main td {
    background-color: var(--color-neutral);
    border-radius: 10px;
    padding: 8px;
  }
</style>

<!-- ===== MOBILE UX BOOST (Overrides) ===== -->
<style>
  /* Smooth scroll + cegah chaining */
  .insurance-table__scroll {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-x: contain;
    touch-action: pan-x;
    scrollbar-gutter: stable both-edges;
    scroll-snap-type: x proximity;
  }

  /* Variabel lebar kolom */
  :root {
    --mobile-first-col: clamp(140px, 36vw, 220px);
    --mobile-col:       clamp(140px, 40vw, 240px);
  }
  @media (max-width: 426px) {
    :root {
      --mobile-first-col: clamp(120px, 44vw, 180px);
      --mobile-col:       clamp(120px, 48vw, 200px);
    }
  }

  /* Pakai separate borders agar sticky rapi */
  .insurance-table__scroll table {
    border-collapse: separate !important;
    border-spacing: 0 !important;
    min-width: unset !important; /* override 900px */
    table-layout: fixed !important;
    width: 100%;
  }

  /* Lebar kolom konsisten */
  .insurance-table__scroll th:first-child,
  .insurance-table__scroll td:first-child {
    width: var(--mobile-first-col) !important;
    min-width: var(--mobile-first-col) !important;
    max-width: var(--mobile-first-col) !important;
  }
  .insurance-table__scroll th:not(:first-child),
  .insurance-table__scroll td:not(:first-child) {
    width: var(--mobile-col) !important;
    min-width: var(--mobile-col) !important;
    max-width: var(--mobile-col) !important;
    scroll-snap-align: start;
  }
  .insurance-table__scroll table.single-column-mode th:not(:first-child),
  .insurance-table__scroll table.single-column-mode td:not(:first-child) {
    min-width: calc(100% - var(--mobile-first-col)) !important;
    max-width: calc(100% - var(--mobile-first-col)) !important;
  }

  /* Sticky layering stabil */
  .insurance-table__scroll thead th {
    position: sticky;
    top: 0;
    z-index: 4;
    background: var(--color-neutral);
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
  }
  .insurance-table__scroll td:first-child,
  .insurance-table__scroll th:first-child {
    position: sticky;
    left: 0;
    background: var(--color-neutral);
    z-index: 2;
    border-right: 1px solid var(--color-border);
    box-shadow: 6px 0 8px -6px rgba(0,0,0,.08);
    background-clip: padding-box;
  }
  .insurance-table__scroll thead th:first-child { z-index: 5; }

  /* Border tunggal (hindari dobel) */
  .insurance-table__scroll th,
  .insurance-table__scroll td {
    border: 0 !important;
    box-sizing: border-box;
    color: var(--color-primary);
    background: var(--color-neutral);
    font-variant-numeric: tabular-nums;
  }
  .insurance-table__scroll tr th + th,
  .insurance-table__scroll tr td + td {
    border-left: 1px solid var(--color-border);
  }
  .insurance-table__scroll tbody tr + tr td,
  .insurance-table__scroll tbody tr + tr th {
    border-top: 1px solid var(--color-border);
  }

  /* Wrap judul, nilai single-line supaya tidak “lompat” */
  .insurance-table__scroll th:first-child,
  .insurance-table__scroll td:first-child {
    white-space: normal;
    word-break: break-word;
  }

  /* Highlight row kategori */
  .insurance-table__scroll tr.highlight-row td {
    background: var(--color-background-third) !important;
    font-weight: 600;
    white-space: normal;
    padding-top: 12px;
    padding-bottom: 12px;
    border-top: 2px solid var(--color-border) !important;
  }

  /* Zebra rows (tidak ganggu kolom pertama & highlight) */
  .insurance-table__scroll tbody tr:nth-child(even):not(.highlight-row) td:not(:first-child) {
    background: color-mix(in srgb, var(--color-neutral) 92%, #000 8%);
  }
</style>
<!-- ===== END MOBILE UX BOOST ===== -->

<!-- ===== Shared value/note styling (desktop & mobile) ===== -->
<style>
  .insurance-table__main .ins-val,
  .insurance-table__scroll .ins-val { display: inline; }

  .insurance-table__main .ins-note,
  .insurance-table__scroll .ins-note {
    display: block;
    white-space: normal;
    font-size: 12px;
    line-height: 1.2;
    color: var(--color-secondary);
    opacity: .9;
    margin-top: 2px;
  }
  .benefits-list {
    padding: 0 0 0 10px;
    margin: 0;
  }
  .benefits-list li {
    line-height: 1.3;
    padding: 2px 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const container = document.querySelector('.insurance-table__container');
    const button = container.querySelector('.insurance-table__expand-button');

    button.addEventListener('click', function () {
      container.classList.add('insurance-table__container--expanded');
      button.style.display = 'none';
    });
  });
</script>

{% comment %} Section For Desktop (schema baru tanpa items) {% endcomment %}
<h2 class="insurance__heading">Insurance Details</h2>

<div class="insurance-table__container">
  <button class="insurance-table__expand-button">
    <span>Click to see more ▼</span>
  </button>

  <div class="insurance-table__title desktop">
    <span>Insurance Package</span>
  </div>

  {% assign json = product.metafields.insurance.package.value %}
  {% assign plans = json.benefits_plan %}
  {% assign packages = json.insurance_package %}

  <div class="insurance-table__main">
    <div>
      <table cellspacing="0" cellpadding="8" style="border-collapse: separate; border-spacing: 10px; width: 100%;">
        <thead style="background-color: var(--color-neutral);">
          <tr>
            <th colspan="2">Benefits</th>
            {% for plan in plans %}
              <th>{{ plan }}</th>
            {% endfor %}
          </tr>
        </thead>

        <tbody>
          {% for cat in packages %}
            {% assign total_rows = cat.sub_benefits | size %}
            {% for sb in cat.sub_benefits %}
              <tr>
                {% if forloop.first %}
                  <th rowspan="{{ total_rows }}">{{ cat.name }}</th>
                {% endif %}
                <th>{{ sb.name }}</th>

                {% for _ in plans %}
                  {% assign b = sb.benefits[forloop.index0] %}
                  {% if b %}
                    {% assign bv = b | remove: ',' | plus: 0 %}
                    <td>
                      {% if b contains '|' %}
                        <ul class="benefits-list">
                          {% assign benefit_items = b | split: '|' %}
                          {% for item in benefit_items %}
                            <li>{{ item | strip }}</li>
                          {% endfor %}
                        </ul>
                      {% else %}
                        <span class="ins-val">{{ b }}</span>
                      {% endif %}
                      {% if sb.name == 'Medical Expenses' and bv > 590000000 %}
                        <span class="ins-note">(minimum of €30,000 is required for applying Schengen visa)</span>
                      {% endif %}
                    </td>
                  {% else %}
                    <td>-</td>
                  {% endif %}
                {% endfor %}
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% comment %} Section For Mobile (schema baru tanpa items) {% endcomment %}
<section>
  <div class="insurance-table__title mobile">
    <span>Insurance Package</span>
  </div>

  {% assign json = product.metafields.insurance.package.value %}
  {% assign plans = json.benefits_plan %}
  {% assign packages = json.insurance_package %}
  {% assign plan_count = plans | size %}
  {% if plan_count == 1 %}
    {% assign table_class = 'single-column-mode' %}
  {% else %}
    {% assign table_class = '' %}
  {% endif %}

  <div class="insurance-table__scroll">
    <table class="{{ table_class }}" style="z-index: 1">
      <thead>
        <tr>
          <th>Benefits</th>
          {% for plan in plans %}
            <th>{{ plan }}</th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        {% for cat in packages %}
          <tr class="highlight-row">
            <td colspan="{{ plan_count | plus: 1 }}"><b>{{ cat.name }}</b></td>
          </tr>

          {% for sb in cat.sub_benefits %}
            <tr>
              <td>{{ sb.name }}</td>
              {% for _ in plans %}
                {% assign b = sb.benefits[forloop.index0] %}
                {% if b %}
                  {% assign bv = b | remove: ',' | plus: 0 %}
                  <td>
                    {% if b contains '|' %}
                        <ul class="benefits-list">
                          {% assign benefit_items = b | split: '|' %}
                          {% for item in benefit_items %}
                            <li>{{ item | strip }}</li>
                          {% endfor %}
                        </ul>
                      {% else %}
                        <span class="ins-val">{{ b }}</span>
                      {% endif %}
                    {% if sb.name == 'Medical Expenses' and bv > 590000000 %}
                      <span class="ins-note">(minimum of €30,000 is required for applying Schengen visa)</span>
                    {% endif %}
                  </td>
                {% else %}
                  <td>-</td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
